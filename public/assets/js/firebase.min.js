function updateSharedGame(e,t){if(""!==t){const a=getDatabase();t["!gameName!"]=t["!gameName!"].slice(t["!gameName!"].lastIndexOf("/")+1);const n={};return n[decodeURIComponent(e)]=t,update(ref(a),n)}}async function signInWithIdAndroid(e){try{$(".dot").hide(),$("#signInTxt").show(),$("#gIcon").show()}catch{}document.getElementById("signInTxt").innerHTML="Odjava",console.log(uid),sessionStorage.uid=uid,userk=e,signInMessage.innerHTML="Pozdravljeni, "+e.split(" ")[0]}import{initializeApp}from"https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js";import{getDatabase,ref,child,get,update,onValue}from"https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";import{getAuth,signInWithPopup,GoogleAuthProvider,signOut,onAuthStateChanged,signInWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";const firebaseConfig={apiKey:"AIzaSyBrxvJ-fs7wtfnsLzOy6WI_1J_CMHPXpoU",authDomain:"tarock-counter.web.app",projectId:"tarock-counter",storageBucket:"tarock-counter.appspot.com",messagingSenderId:"1058014595030",appId:"1:1058014595030:web:3f9c1a0095ef78276d4677",measurementId:"G-K7NFBYQN0F",databaseURL:"https://tarock-counter-default-rtdb.europe-west1.firebasedatabase.app/"},app=initializeApp(firebaseConfig),auth=getAuth(),provider=new GoogleAuthProvider,signInButton=document.getElementById("signInGoogle"),analytics=getAnalytics(app),signInMessage=document.getElementById("signInMessage");var uid=null;export function deleteAllDataF(){if(null!==sessionStorage.uid&&navigator.onLine){userSignOut(),setTimeout(()=>{localStorage.clear()},500);const e=getDatabase(),t={};return t["users/"+sessionStorage.uid]={},update(ref(e),t)}}window.deleteAllDataF=deleteAllDataF;const userSignIn=async()=>{if($(".dot").show(),$("#signInTxt").hide(),$("#gIcon").hide(),null!==sessionStorage.uid&&void 0!==sessionStorage.uid&&"null"!==sessionStorage.uid&&"undefined"!==sessionStorage.uid)userSignOut();else try{AndroidInt.signInInterface(),console.log("android")}catch(e){signInWithPopup(auth,provider).then(e=>{const t=e.user;uid=e.user.uid,sessionStorage.uid=uid,userk=t,loadDataFromWeb()}).catch(e=>{signInMessage.innerHTML="Nekaj je Å¡lo narobe pri prijavi"})}},userSignOut=async()=>{signOut(auth).then(e=>{document.getElementById("dlgSlct").innerHTML="";let t=localStorage.themeColor;localStorage.clear(),localStorage.themeColor=t}).catch(e=>{})};onAuthStateChanged(auth,e=>{try{$(".dot").hide(),$("#signInTxt").show(),$("#gIcon").show()}catch{}e?(setTimeout(()=>{location.pathname.includes("users")&&upload()},10),document.getElementById("signInTxt").innerHTML="Odjava",sessionStorage.uid=e.uid,null==localStorage.offlineChanges?loadDataFromWeb():navigator.onLine&&(console.log("update"),updateUserData(),localStorage.offlineChanges=void 0),navigator.onLine||Game(),watchChanges(),userk=e,signInMessage.innerHTML="Pozdravljeni, "+e.displayName.split(" ")[0]):(setTimeout(()=>{location.pathname.includes("users")&&upload()},10),document.getElementById("signInTxt").innerHTML="Prijava",sessionStorage.uid=null,signInMessage.innerHTML="Niste prijavljeni")}),signInButton.addEventListener("click",userSignIn);const database=getDatabase(app);export function updateUserData(){if(null!==sessionStorage.uid&&void 0!==sessionStorage.uid&&"null"!==sessionStorage.uid&&"undefined"!==sessionStorage.uid){const e=getDatabase(),t={},a=JSON.parse(localStorage.getItem("games"))||{};for(const e in a)a.hasOwnProperty(e)&&e.includes("/users/")&&(a[encodeURIComponent(e)]="",updateSharedGame(encodeURIComponent(e),a[e]),delete a[e]);return t["/users/"+sessionStorage.uid+"/games/"]=a,update(ref(e),t)}}var userk=auth.currentUser;window.updateUserData=updateUserData;export async function updateSharedRemote(){var e=ref(database,listOfPlayers["!gameName!"]);onValue(e,async e=>{function t(e){const t=Object.keys(e).sort(),a={};return t.forEach(t=>{a[t]=e[t]}),a}let a=e.val(),n=listOfPlayers["!gameName!"];const s=JSON.parse(localStorage.getItem("games"))||{};decodeURIComponent(JSON.stringify(t(a))).replace(/\/users\/.*\/games\//,"")!==decodeURIComponent(JSON.stringify(t(listOfPlayers))).replace(/\/users\/.*\/games\//,"")&&(s[listOfPlayers["!gameName!"]]=a,s[listOfPlayers["!gameName!"]]["!gameName!"]=n,localStorage.setItem("games",JSON.stringify(s)),listOfPlayers=s[listOfPlayers["!gameName!"]],setTimeout(()=>{0!==document.getElementsByClassName("cntScreen").length&&(removeElement(document.querySelector(".cntScreen"),document.querySelector(".crezultLine")),count(!1))},500))})}export async function watchChanges(){var e=ref(database,"users/"+sessionStorage.uid);onValue(e,async e=>{function t(e){const t=Object.keys(e).sort(),a={};return t.forEach(t=>{a[t]=e[t]}),a}var a=e.val().games,n=JSON.parse(localStorage.getItem("games"))||{};if(decodeURIComponent(JSON.stringify(t(a)))!==decodeURIComponent(JSON.stringify(t(n)))){console.log("change"),n=a;for(const e in n)n.hasOwnProperty(e)&&e.includes("%2Fusers%2F")&&(n[decodeURIComponent(e)]="",delete n[e]);localStorage.setItem("games",JSON.stringify(n)),setTimeout(()=>{0!==document.getElementsByClassName("cntScreen").length&&(listOfPlayers=n[listOfPlayers["!gameName!"]],removeElement(document.querySelector(".cntScreen"),document.querySelector(".crezultLine")),count(!0))},500)}})}window.watchChanges=watchChanges;export function loadDataFromWeb(){const e=ref(getDatabase());get(child(e,`users/${sessionStorage.uid}`)).then(e=>{if(e.exists()){let t=e.val().games;for(const[e,a]of Object.entries(t)){const t=JSON.parse(localStorage.getItem("games"))||{};t[decodeURIComponent(e)]=a,localStorage.setItem("games",JSON.stringify(t))}return updateUserData(),Game(),!0}return!1}).catch(e=>{console.error(e)})}export async function loadDataPath(e){const t=ref(getDatabase());var a;return await get(child(t,e)).then(e=>{if(!e.exists())return"";a=e.val()}).catch(e=>{console.error(e)}),a}export async function registerCredential(){}window.signInWithIdAndroid=signInWithIdAndroid,window.loadDataFromWeb=loadDataFromWeb,window.loadDataPath=loadDataPath,window.updateSharedRemote=updateSharedRemote;