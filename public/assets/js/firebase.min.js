async function deleteAllDataF(){if(null!==sessionStorage.uid&&navigator.onLine){userSignOut(),setTimeout(()=>{localStorage.clear(),sessionStorage.clear()},500);const e=getDatabase(),t={};return t["users/"+sessionStorage.uid]={},auth.currentUser.delete(),await update(ref(e),t)}}function loginSheet(){if(userk)userSignOut();else{let e=makeBottomheet("Prijava"),t=addElement("button",e,"googleBtnIn");t.innerHTML='<span>Google prijava</span><svg viewBox="-3 0 262 262" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><path d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027" fill="#4285F4"/><path d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1" fill="#34A853"/><path d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782" fill="#FBBC05"/><path d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251" fill="#EB4335"</svg>',t.addEventListener("click",userSignIn),addElement("div",e,"break");let a=addElement("button",e,"googleBtnIn");a.innerHTML='<span>Facebook prijava</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="facebook"><path fill="#1976D2" fill-rule="evenodd" d="M12 5.5H9v-2a1 1 0 0 1 1-1h1V0H9a3 3 0 0 0-3 3v2.5H4V8h2v8h3V8h2l1-2.5z" clip-rule="evenodd"></path></svg>',a.addEventListener("click",facebookSignIn)}}function updateSharedGame(e,t){if(""!==t){const a=getDatabase();t["!gameName!"]=t["!gameName!"].slice(t["!gameName!"].lastIndexOf("/")+1);const o={};return o[decodeURIComponent(e)]=t,update(ref(a),o)}}import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";import{getAnalytics,setConsent}from"https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";import{getPerformance}from"https://www.gstatic.com/firebasejs/10.12.3/firebase-performance.js";import{getDatabase,ref,child,get,update,onValue}from"https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";import{getAuth,signInWithPopup,GoogleAuthProvider,FacebookAuthProvider,signOut,fetchSignInMethodsForEmail,onAuthStateChanged,signInWithCredential}from"https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";const firebaseConfig={apiKey:"AIzaSyBrxvJ-fs7wtfnsLzOy6WI_1J_CMHPXpoU",authDomain:"http://stevec-taroka.si",projectId:"tarock-counter",storageBucket:"tarock-counter.appspot.com",messagingSenderId:"1058014595030",appId:"1:1058014595030:web:3f9c1a0095ef78276d4677",measurementId:"G-K7NFBYQN0F",databaseURL:"https://tarock-counter-default-rtdb.europe-west1.firebasedatabase.app/"},app=initializeApp(firebaseConfig),auth=getAuth(),perf=getPerformance(app),provider=new GoogleAuthProvider,fbProvider=new FacebookAuthProvider,analytics=getAnalytics(app),signInMessage=document.getElementById("signInMessage");var uid=null;setConsent({analytics_storage:"denied",ad_storage:"denied"}),window.addEventListener("load",function(){if(!checkConset()){let e=makeBottomheet("Piškotki",!0);e.innerHTML="<span style='margin-bottom:20px;'>Spletna stran uporablja piškotke za delovanje.</span>",addElement("div",e,"break");let t=addElement("md-text-button",e);t.innerHTML="Politika",t.addEventListener("click",privacy);let a=addElement("md-filled-tonal-button",e);a.innerHTML="Se strinjam",a.addEventListener("click",function(){setConsent({analytics_storage:"true",ad_storage:"true"});const e=new Date;e.setMonth(e.getMonth()+1);const t=e.toUTCString();document.cookie=`consentCookies=true; expires=${t}; path=/`,document.querySelector(".bottomSheetScrim").click()})}}),window.deleteAllDataF=deleteAllDataF,window.onGoogleLibraryLoad=(()=>{console.log("Google library loaded")});const facebookSignIn=e=>{null!==sessionStorage.uid&&void 0!==sessionStorage.uid&&"null"!==sessionStorage.uid&&"undefined"!==sessionStorage.uid?userSignOut():signInWithPopup(auth,fbProvider).then(e=>{const t=e.user;uid=e.user.uid,sessionStorage.uid=uid,userk=t,loadDataFromWeb(),document.querySelector(".bottomSheetScrim").click()}).catch(e=>{signInMessage.innerHTML="Nekaj je šlo narobe pri prijavi",document.querySelector(".bottomSheetScrim").click(),e.message.includes("account-exists-with-different-credential")&&(signInMessage.innerHTML="Napaka - poskusite se prijaviti z Googlom")})},userSignIn=async()=>{const e=navigator.userAgent.toLowerCase();if(["fb_iab","fban","fbav","instagram"].some(t=>e.includes(t)))facebookIntent("stevec-taroka.si");else if(null!==sessionStorage.uid&&void 0!==sessionStorage.uid&&"null"!==sessionStorage.uid&&"undefined"!==sessionStorage.uid)userSignOut();else try{function t(e){if(e.credential){const t=GoogleAuthProvider.credential(e.credential);signInWithCredential(auth,t).then(function(e){const t=e.user;uid=e.user.uid,sessionStorage.uid=uid,userk=t,loadDataFromWeb(),document.querySelector(".bottomSheetScrim").click()})}}google.accounts.id.initialize({client_id:"1058014595030-paljk3kd0chkiakv9mkokt2eic0viqsm.apps.googleusercontent.com",callback:t,use_fedcm_for_prompt:!0}),google.accounts.id.prompt(e=>{"skipped"===e.g&&(console.log("Pop Up Closed!"),signInWithPopup(auth,provider).then(e=>{const t=e.user;uid=e.user.uid,sessionStorage.uid=uid,userk=t,loadDataFromWeb()}).catch(e=>{signInMessage.innerHTML="Nekaj je šlo narobe pri prijavi"}))})}catch(e){signInWithPopup(auth,provider).then(e=>{const t=e.user;uid=e.user.uid,sessionStorage.uid=uid,userk=t,loadDataFromWeb(),document.querySelector(".bottomSheetScrim").click()}).catch(e=>{signInMessage.innerHTML="Nekaj je šlo narobe pri prijavi",document.querySelector(".bottomSheetScrim").click()})}},userSignOut=async()=>{signOut(auth).then(e=>{userk=!1,document.getElementById("dlgSlct").innerHTML="";let t=localStorage.themeColor;localStorage.clear(),localStorage.themeColor=t}).catch(e=>{})};location.href.includes("web.app")&&(location.href="https://stevec-taroka.si"),onAuthStateChanged(auth,e=>{e?(setTimeout(()=>{location.pathname.includes("users")&&upload()},10),document.querySelector(".signInBtn").innerHTML='Odjava<md-icon slot="icon">logout</md-icon>',document.querySelector(".newGameBtn").style.display="flex",sessionStorage.uid=e.uid,null==localStorage.offlineChanges?loadDataFromWeb():navigator.onLine&&(console.log("update"),updateUserData(),localStorage.offlineChanges=void 0),navigator.onLine||Game(),watchChanges(),userk=e,signInMessage.innerHTML="Pozdravljeni, "+e.displayName.split(" ")[0]):(setTimeout(()=>{location.pathname.includes("users")&&upload()},10),document.querySelector(".signInBtn").innerHTML='Prijava<md-icon slot="icon">login</md-icon>',document.querySelector(".newGameBtn").style.display="none",sessionStorage.uid=null,signInMessage.innerHTML="Niste prijavljeni")});var userk=auth.currentUser;const database=getDatabase(app);export function updateUserData(){if(null!==sessionStorage.uid&&void 0!==sessionStorage.uid&&"null"!==sessionStorage.uid&&"undefined"!==sessionStorage.uid){const e=getDatabase(),t={},a=JSON.parse(localStorage.getItem("games"))||{};for(const e in a)a.hasOwnProperty(e)&&e.includes("/users/")&&(a[encodeURIComponent(e)]="",updateSharedGame(encodeURIComponent(e),a[e]),delete a[e]);return t["/users/"+sessionStorage.uid+"/games/"]=a,update(ref(e),t)}}window.updateUserData=updateUserData;export async function updateSharedRemote(){var e=ref(database,listOfPlayers["!gameName!"]);onValue(e,async e=>{function t(e){const t=Object.keys(e).sort(),a={};return t.forEach(t=>{a[t]=e[t]}),a}let a=e.val(),o=listOfPlayers["!gameName!"];const n=JSON.parse(localStorage.getItem("games"))||{};decodeURIComponent(JSON.stringify(t(a))).replace(/\/users\/.*\/games\//,"")!==decodeURIComponent(JSON.stringify(t(listOfPlayers))).replace(/\/users\/.*\/games\//,"")&&(n[listOfPlayers["!gameName!"]]=a,n[listOfPlayers["!gameName!"]]["!gameName!"]=o,localStorage.setItem("games",JSON.stringify(n)),listOfPlayers=n[listOfPlayers["!gameName!"]],setTimeout(()=>{0!==document.getElementsByClassName("cntScreen").length&&(removeElement(document.querySelector(".cntScreen"),document.querySelector(".crezultLine")),count(!1))},500))})}export async function watchChanges(){var e=ref(database,"users/"+sessionStorage.uid);onValue(e,async e=>{function t(e){const t=Object.keys(e).sort(),a={};return t.forEach(t=>{a[t]=e[t]}),a}var a=e.val().games,o=JSON.parse(localStorage.getItem("games"))||{};if(decodeURIComponent(JSON.stringify(t(a)))!==decodeURIComponent(JSON.stringify(t(o)))){console.log("change"),o=a;for(const e in o)o.hasOwnProperty(e)&&e.includes("%2Fusers%2F")&&(o[decodeURIComponent(e)]="",delete o[e]);localStorage.setItem("games",JSON.stringify(o)),setTimeout(()=>{0!==document.getElementsByClassName("cntScreen").length&&(listOfPlayers=o[listOfPlayers["!gameName!"]],removeElement(document.querySelector(".cntScreen"),document.querySelector(".crezultLine")),count(!0))},500)}})}window.watchChanges=watchChanges;export function loadDataFromWeb(){const e=ref(getDatabase());get(child(e,`users/${sessionStorage.uid}`)).then(e=>{if(e.exists()){let t=e.val().games;for(const[e,a]of Object.entries(t)){const t=JSON.parse(localStorage.getItem("games"))||{};t[decodeURIComponent(e)]=a,localStorage.setItem("games",JSON.stringify(t))}return updateUserData(),Game(),!0}return!1}).catch(e=>{console.error(e)})}export async function loadDataPath(e){const t=ref(getDatabase());var a;return await get(child(t,e)).then(e=>{if(!e.exists())return"";a=e.val()}).catch(e=>{console.error(e)}),a}window.loadDataFromWeb=loadDataFromWeb,window.loadDataPath=loadDataPath,window.updateSharedRemote=updateSharedRemote,window.loginSheet=loginSheet;